<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Te amo mi bichita</title>
<style>
/* --- Estilos originales se mantienen --- */
body { font-family: Arial, sans-serif; text-align:center; background:#f2f2f2; margin:0; padding:20px; }
h1 { margin-bottom:20px; }
.player-buttons { display:flex; justify-content:space-around; margin:20px 0; }
.player-btn { flex:1; margin:10px; padding:30px; font-size:24px; font-weight:bold; border:none; border-radius:15px; cursor:pointer; color:white; }
#player1-btn { background-color:#fcc7ef; }
#player2-btn { background-color:#9bd6f8; }
#message { font-size:20px; margin:15px 0; font-weight:bold; }
.scores { display:flex; justify-content:space-around; margin-top:20px; }
.score-box { background:white; padding:15px; border-radius:10px; box-shadow:0px 3px 6px rgba(0,0,0,0.2); width:200px; }
.score-box h2 { margin:5px 0; }
.score-buttons { display:flex; justify-content:space-between; margin-top:10px; }
.score-btn { flex:1; margin:0 5px; padding:10px; font-size:16px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; color:white; }
.add { background-color:#2ecc71; }
.subtract { background-color:#e67e22; }

/* --- Barra tipo Spotify --- */
#controls { margin:20px 0; display:flex; flex-direction:column; align-items:center; }
#progress-container { width:300px; height:10px; background:#ccc; border-radius:5px; margin-top:10px; overflow:hidden; }
#progress { height:100%; width:0; background:#2ecc71; border-radius:5px; transition: width 0.1s linear; }

#yt-player-container { display:none; }
#song-title { font-size:18px; font-weight:bold; margin-top:10px; filter:blur(5px); }
</style>
</head>
<body>

<h1>üéµüíï Adivina la cancion con Cele y Tade üíïüéµ</h1>

<div id="controls">
  <div>
    <button onclick="togglePlay()">‚ñ∂Ô∏è Play/Pause</button>
    <button onclick="nextSong()">‚è≠ Siguiente Canci√≥n</button>
    <button onclick="revealSong()">üëÄ Revelar Canci√≥n</button>
  </div>
  <div id="progress-container">
    <div id="progress"></div>
  </div>
</div>

<div id="yt-player-container"><div id="player"></div></div>

<div class="player-buttons">
  <button id="player1-btn" class="player-btn" onclick="playerPressed(1)">Cele</button>
  <button id="player2-btn" class="player-btn" onclick="playerPressed(2)">Tade</button>
</div>
<button id="reset-btn" onclick="resetButtons()">Resetear Turno</button>
<div id="message"></div>
<div id="song-title"></div>

<div class="scores">
  <div class="score-box">
    <h2>Cele: <span id="score1">0</span></h2>
    <div class="score-buttons">
      <button class="score-btn add" onclick="addPoint(1)">+1</button>
      <button class="score-btn subtract" onclick="subtractPoint(1)">-1</button>
    </div>
  </div>
  <div class="score-box">
    <h2>Tade: <span id="score2">0</span></h2>
    <div class="score-buttons">
      <button class="score-btn add" onclick="addPoint(2)">+1</button>
      <button class="score-btn subtract" onclick="subtractPoint(2)">-1</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* --- Firebase --- */
const firebaseConfig = {
  apiKey:"AIzaSyDnm7xpjFtaqwYeCRJG0ms8QR7J9k010Tk",
  authDomain:"juegoadivinalacancion-5152e.firebaseapp.com",
  projectId:"juegoadivinalacancion-5152e",
  storageBucket:"juegoadivinalacancion-5152e.firebasestorage.app",
  messagingSenderId:"543704119927",
  appId:"1:543704119927:web:613939b3ffee9dab25e472",
  measurementId:"G-TYSK5TJCMZ"
};
const app = firebase.initializeApp(firebaseConfig);
const analytics = firebase.analytics();
const db = firebase.database();

/* --- Variables --- */
let score1=0, score2=0, isPlaying=false;
let player;
const playlist = [
  {id:"dQw4w9WgXcQ", title:"Canci√≥n Misteriosa 1"},
  {id:"3JZ4pnNtyxQ", title:"Canci√≥n Misteriosa 2"},
  {id:"L_jWHffIx5E", title:"Canci√≥n Misteriosa 3"}
];
let currentSong = playlist[0];

/* --- YouTube Player --- */
function onYouTubeIframeAPIReady(){
  player = new YT.Player('player', {
    height:'315', width:'560', videoId:currentSong.id,
    events:{'onReady':()=>player.pauseVideo(), 'onStateChange': onStateChange}
  });
}

/* --- Barra de progreso --- */
function onStateChange(event){
  if(event.data == YT.PlayerState.PLAYING){
    requestAnimationFrame(updateProgress);
  }
}
function updateProgress(){
  if(player && player.getCurrentTime && player.getDuration){
    const pct = (player.getCurrentTime()/player.getDuration())*100;
    document.getElementById("progress").style.width = pct+"%";
    if(isPlaying) requestAnimationFrame(updateProgress);
  }
}

/* --- Jugadores --- */
function playerPressed(num){ db.ref('game/lastClick').set({player:num,time:Date.now()}); }
function resetButtons(){
  document.getElementById("player1-btn").disabled=false;
  document.getElementById("player2-btn").disabled=false;
  document.getElementById("player1-btn").style.display="inline-block";
  document.getElementById("player2-btn").style.display="inline-block";
  document.getElementById("message").innerText="";
  db.ref('game/lastClick').set(null);
}
db.ref('game/lastClick').on('value', snap=>{
  const data=snap.val();
  if(!data) return;
  const num=data.player;
  document.getElementById("message").innerText=num===1?"¬°Cele presion√≥ primero!":"¬°Tade presion√≥ primero!";
  document.getElementById("player1-btn").disabled=true;
  document.getElementById("player2-btn").disabled=true;
  document.getElementById("player1-btn").style.display=num===1?"inline-block":"none";
  document.getElementById("player2-btn").style.display=num===2?"inline-block":"none";
});

/* --- Puntajes --- */
function addPoint(num){ if(num===1){score1++; db.ref('game/score1').set(score1);} else {score2++; db.ref('game/score2').set(score2);} }
function subtractPoint(num){ if(num===1){score1--; db.ref('game/score1').set(score1);} else {score2--; db.ref('game/score2').set(score2);} }
db.ref('game/score1').on('value', snap=>{score1=snap.val()||0; document.getElementById("score1").innerText=score1;});
db.ref('game/score2').on('value', snap=>{score2=snap.val()||0; document.getElementById("score2").innerText=score2;});

/* --- YouTube sincronizado --- */
function togglePlay(){ db.ref('game/play').set(!isPlaying); }
db.ref('game/play').on('value', snap=>{
  const val=snap.val();
  if(val) player.playVideo(); else player.pauseVideo();
  isPlaying=val;
});

function nextSong(){
  const next = playlist[Math.floor(Math.random()*playlist.length)];
  db.ref('game/song').set(next);
}
db.ref('game/song').on('value', snap=>{
  const val=snap.val();
  if(!val) return;
  currentSong=val;
  if(player) player.loadVideoById(currentSong.id);
  document.getElementById("song-title").innerText="";
});

function revealSong(){ db.ref('game/reveal').set(currentSong.title); }
db.ref('game/reveal').on('value', snap=>{
  const title = snap.val();
  if(title) document.getElementById("song-title").innerText=title;
});
</script>
</body>
</html>
